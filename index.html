<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Roblox Panel</title>

<style>
/* ======= SAME CSS YOU ALREADY HAD (UNCHANGED) ======= */
:root{
  --bg:#f7f7fb;--surface:#ffffff;--surface2:#fbfbfd;--text:#111318;
  --muted:#5c6370;--border:#e6e8ee;--border2:#d9dde6;--ring:#111318;
  --btn:#ffffff;--btnText:#111318;--btnBorder:#d9dde6;--btnHover:#f3f4f7;
  --danger:#b00020;--ok:#0b7a3b;
  --radius:16px;--radius2:14px;
  --shadow:0 10px 30px rgba(17,19,24,.08);
  --focus:0 0 0 4px rgba(17,19,24,.12);
}
[data-theme="dark"]{
  --bg:#0c0f14;--surface:#121722;--surface2:#0f1420;--text:#e9edf6;
  --muted:#a9b2c3;--border:#202a3a;--border2:#2a3750;--ring:#e9edf6;
  --btn:#141b29;--btnText:#e9edf6;--btnBorder:#2a3750;--btnHover:#1a2436;
  --danger:#ff4d6d;--ok:#3ddc84;
  --shadow:0 14px 40px rgba(0,0,0,.45);
  --focus:0 0 0 4px rgba(233,237,246,.16);
}
*{box-sizing:border-box}
body{
  font-family:system-ui,Arial;
  margin:0;background:var(--bg);color:var(--text);
  min-height:100vh;display:flex;justify-content:center;align-items:center;padding:24px;
}
button{cursor:pointer}
button:disabled{opacity:.45;cursor:not-allowed}
</style>
</head>

<body>

<!-- UI CONTENT OMITTED FOR BREVITY â€” YOUR EXISTING HTML STRUCTURE IS UNCHANGED -->

<script>
/* =====================================================
   COOLDOWN SYSTEM
   ===================================================== */

const buttonCooldowns = new WeakMap();

function startCooldown(button, seconds){
  const originalText = button.textContent;
  button.disabled = true;
  const until = Date.now() + seconds * 1000;
  buttonCooldowns.set(button, originalText);

  const tick = () => {
    const left = Math.ceil((until - Date.now()) / 1000);
    if (left > 0){
      button.textContent = `â³ ${left}s`;
      setTimeout(tick, 250);
    } else {
      button.textContent = buttonCooldowns.get(button) || originalText;
      button.disabled = false;
      buttonCooldowns.delete(button);
    }
  };
  tick();
}

/* =====================================================
   BUTTON REFERENCES (same IDs as your file)
   ===================================================== */

const els = {
  refresh: document.getElementById("refresh"),
  save: document.getElementById("save"),
  clearModerated: document.getElementById("clearModerated"),
  kick: document.getElementById("kick"),
  kickReason: document.getElementById("kickReason"),
  ban: document.getElementById("ban"),
  banReason: document.getElementById("banReason"),
  unban: document.getElementById("unban"),
  unbanReason: document.getElementById("unbanReason"),

  themeLight: document.getElementById("themeLight"),
  themeDark: document.getElementById("themeDark"),
  themeAuto: document.getElementById("themeAuto"),
};

/* =====================================================
   ACTION HANDLERS (WRAPPED WITH COOLDOWNS)
   ===================================================== */

// ðŸ”„ Refresh â€” 10s cooldown
els.refresh.onclick = async () => {
  if (els.refresh.disabled) return;
  startCooldown(els.refresh, 10);
  await fetchPlayers();
};

// ðŸ’¾ Save â€” 3s
els.save.onclick = () => {
  startCooldown(els.save, 3);
  localStorage.setItem("players_api_url", playersApi.value.trim());
  localStorage.setItem("admin_key_v1", adminKey.value.trim());
  toast("ok", "Saved", "Settings stored");
};

// ðŸ§¹ Clear moderated â€” 3s
els.clearModerated.onclick = () => {
  if (!confirm("Clear moderated list?")) return;
  startCooldown(els.clearModerated, 3);
  saveModerated([]);
  renderModerated();
};

// ðŸ‘¢ Kick â€” 3s
els.kick.onclick = async () => {
  const p = getSelectedActive();
  if (!p) return;
  startCooldown(els.kick, 3);
  await sendModeration("kick", p.userId);
};

// ðŸ“ Kick with reason â€” 3s
els.kickReason.onclick = async () => {
  const p = getSelectedActive();
  if (!p) return;
  const r = prompt("Kick reason?") || "";
  startCooldown(els.kickReason, 3);
  await sendModeration("kick", p.userId, r);
};

// â›” Ban â€” 3s
els.ban.onclick = async () => {
  const p = getSelectedActive();
  if (!p) return;
  startCooldown(els.ban, 3);
  await sendModeration("ban", p.userId);
};

// ðŸ§¾ Ban with reason â€” 3s
els.banReason.onclick = async () => {
  const p = getSelectedActive();
  if (!p) return;
  const r = prompt("Ban reason?") || "";
  startCooldown(els.banReason, 3);
  await sendModeration("ban", p.userId, r);
};

// âœ… Unban â€” 3s
els.unban.onclick = async () => {
  const p = getSelectedModerated();
  if (!p) return;
  startCooldown(els.unban, 3);
  await sendModeration("unban", p.userId);
};

// ðŸ—’ï¸ Unban with note â€” 3s
els.unbanReason.onclick = async () => {
  const p = getSelectedModerated();
  if (!p) return;
  const r = prompt("Unban note?") || "";
  startCooldown(els.unbanReason, 3);
  await sendModeration("unban", p.userId, r);
};

/* =====================================================
   THEME BUTTONS â€” NO DELAY
   ===================================================== */

els.themeLight.onclick = () => applyTheme("light");
els.themeDark.onclick = () => applyTheme("dark");
els.themeAuto.onclick = () => applyTheme("auto");

/* =====================================================
   IMPORTANT:
   - fetchPlayers() is ONLY called by Refresh
   - No setInterval anywhere
   ===================================================== */
</script>

</body>
</html>
